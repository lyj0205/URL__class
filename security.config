'''

import com.example.noticeboard.oauth.service.CustomOAuth2UserService;
import com.example.noticeboard.oauth.support.CustomAuthenticationFailureHandler;
import com.example.noticeboard.oauth.support.OAuth2AuthenticationSuccessHandler;
import com.example.noticeboard.security.jwt.support.JwtAuthenticationFilter;
import com.example.noticeboard.account.user.constant.UserRole;
import com.example.noticeboard.admin.visitant.util.SingleVisitInterceptor;
import com.example.noticeboard.common.exception.FilterExceptionHandler;
import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.HttpMethod;
import org.springframework.security.config.annotation.web.HttpSecurityBuilder;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configurers.AbstractAuthenticationFilterConfigurer;
import org.springframework.security.config.annotation.web.configurers.oauth2.client.OAuth2LoginConfigurer;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.oauth2.client.web.OAuth2LoginAuthenticationFilter;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;

@Configuration
@EnableWebSecurity
@RequiredArgsConstructor
public class SecurityConfig {

    private final JwtAuthenticationFilter authenticationFilter;
    private final CustomOAuth2UserService oauth2UserService;
    private final SingleVisitInterceptor singleVisitInterceptor;
    private final OAuth2AuthenticationSuccessHandler oauth2AuthenticationSuccessHandler;
    private final CustomAuthenticationFailureHandler customAuthenticationFailureHandler;

    @Bean
    public BCryptPasswordEncoder encodePassword() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.csrf().disable()
                .httpBasic().disable()
                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)
                .and()
                .authorizeHttpRequests()
                .requestMatchers(HttpMethod.GET, "/admin/**").hasRole(UserRole.MANAGER.name())
                .requestMatchers(HttpMethod.GET, "/**").permitAll()
                .requestMatchers(HttpMethod.POST, "/admin/report/**" , "/admin/login", "/mail/**", "/admin/login", "/logins", "/registers", "/oauth/token", "/user/logout").permitAll()
                .requestMatchers( "/admin/**").hasRole(UserRole.MANAGER.name())
                .requestMatchers(HttpMethod.POST, "/**").hasAnyRole(UserRole.USER.name(), UserRole.MANAGER.name())
                .requestMatchers(HttpMethod.PATCH, "/posts/views/**").permitAll()
                .requestMatchers(HttpMethod.DELETE, "/**").hasAnyRole(UserRole.USER.name(), UserRole.MANAGER.name())
                .requestMatchers(HttpMethod.PATCH, "/**").permitAll()
                .requestMatchers(HttpMethod.PUT, "/**").hasAnyRole(UserRole.USER.name(), UserRole.MANAGER.name())
                .and()
                // Configures authentication support using an OAuth 2.0 and/or OpenID Connect 1.0 Provider. 
                .oauth2Login().loginPage("/authorization/denied")
                // loginPageê°€ ë¦¬í„´í•˜ëŠ” OAuth2LoginConfigurerëŠ” ë‹¤ìŒê³¼ ê°™ìŒ.
// public final class OAuth2LoginConfigurer<B extends HttpSecurityBuilder<B>>
// extends AbstractAuthenticationFilterConfigurer<B, org.springframework.security.config.annotation.web.configurers.oauth2.client.OAuth2LoginConfigurer<B>, OAuth2LoginAuthenticationFilter>
                // OAuth2LoginAuthenticationFilter
                .successHandler(oauth2AuthenticationSuccessHandler)
                .failureHandler(customAuthenticationFailureHandler)
                .userInfoEndpoint().userService(oauth2UserService);

        http.addFilterBefore(new FilterExceptionHandler(),
                UsernamePasswordAuthenticationFilter.class);

        http.addFilterBefore(singleVisitInterceptor,
                UsernamePasswordAuthenticationFilter.class
        );

        http.addFilterBefore(authenticationFilter,
                UsernamePasswordAuthenticationFilter.class);

        return http.build();
    }
---

### âœ… SecurityConfig í´ë˜ìŠ¤ë€?

`SecurityConfig` í´ë˜ìŠ¤ëŠ” Spring Securityë¥¼ ì‚¬ìš©í•˜ì—¬ **ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë³´ì•ˆ ì„¤ì •ì„ ë‹´ë‹¹**í•˜ëŠ” í•µì‹¬ êµ¬ì„± í´ë˜ìŠ¤ì…ë‹ˆë‹¤.
ë¡œê·¸ì¸, ì¸ì¦, ì¸ê°€, í•„í„° ì¶”ê°€ ë“± ë‹¤ì–‘í•œ ë³´ì•ˆ ê´€ë ¨ ê¸°ëŠ¥ì„ ì´ê³³ì—ì„œ ì„¤ì •í•˜ê²Œ ë©ë‹ˆë‹¤.

---

### ğŸ”’ ì£¼ìš” ê¸°ëŠ¥ ìš”ì•½

1. **JWT ì¸ì¦ ë°©ì‹ ì‚¬ìš©**

   * ì„¸ì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³ , JWT í† í°ì„ í†µí•´ ì‚¬ìš©ì ì¸ì¦ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
   * `STATELESS` ì„¤ì •ìœ¼ë¡œ ì„œë²„ëŠ” ë¡œê·¸ì¸ ìƒíƒœë¥¼ ì €ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

2. **ì†Œì…œ ë¡œê·¸ì¸(OAuth2) ì§€ì›**

   * Google, Kakao ë“± OAuth2 ì œê³µìë¥¼ í†µí•œ ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
   * ë¡œê·¸ì¸ ì„±ê³µ/ì‹¤íŒ¨ì— ë”°ë¥¸ í•¸ë“¤ëŸ¬ë¥¼ ì„¤ì •í•˜ì—¬ ì¶”ê°€ì ì¸ ì²˜ë¦¬ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.

3. **URLë³„ ì ‘ê·¼ ê¶Œí•œ ì œì–´**

   * ì–´ë–¤ ê²½ë¡œëŠ” ë¡œê·¸ì¸ ì—†ì´ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ í—ˆìš©í•˜ê³ ,
   * ì–´ë–¤ ê²½ë¡œëŠ” íŠ¹ì • ì—­í• (ì˜ˆ: USER, MANAGER)ë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì œí•œí•©ë‹ˆë‹¤.

4. **ë³´ì•ˆ ê¸°ëŠ¥ ì„¤ì •**

   * CSRF ë° HTTP Basic ì¸ì¦ì„ ë¹„í™œì„±í™”í•©ë‹ˆë‹¤ (REST API í™˜ê²½ì— ë§ê²Œ).
   * ì„¸ì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³ , í† í° ê¸°ë°˜ ì¸ì¦ì„ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.

5. **ì»¤ìŠ¤í…€ í•„í„° ì¶”ê°€**

   * JWT ì¸ì¦ í•„í„°
   * ì˜ˆì™¸ ì²˜ë¦¬ í•„í„°
   * ë°©ë¬¸ì ì²´í¬ í•„í„° ë“± í•„ìš”í•œ ê¸°ëŠ¥ì„ ì§ì ‘ í•„í„°ë¡œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### ğŸ§© ì„¤ì • ì˜ˆì‹œ ì„¤ëª…

* `@Bean BCryptPasswordEncoder`
  â†’ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•ˆì „í•˜ê²Œ ì•”í˜¸í™”í•˜ì—¬ ì €ì¥í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.

* `http.csrf().disable()`
  â†’ CSRF ë³´í˜¸ ê¸°ëŠ¥ì„ ë•ë‹ˆë‹¤. (ì„¸ì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” REST APIì—ì„œëŠ” ì¼ë°˜ì ì…ë‹ˆë‹¤)

* `sessionCreationPolicy(SessionCreationPolicy.STATELESS)`
  â†’ ì„œë²„ê°€ ì„¸ì…˜ì„ ìƒì„±í•˜ê±°ë‚˜ ì €ì¥í•˜ì§€ ì•Šë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.

* `authorizeHttpRequests()`
  â†’ ê²½ë¡œë³„ë¡œ ì ‘ê·¼ ê¶Œí•œì„ ì„¤ì •í•©ë‹ˆë‹¤.

#### ì˜ˆì‹œ ê¶Œí•œ ì„¤ì •

```plaintext
GET /admin/**          â†’ MANAGER ì—­í• ë§Œ ì ‘ê·¼ ê°€ëŠ¥
GET /**                â†’ ëˆ„êµ¬ë‚˜ ì ‘ê·¼ ê°€ëŠ¥
POST /admin/login ë“±   â†’ ì¼ë¶€ ê²½ë¡œëŠ” ë¡œê·¸ì¸ ì—†ì´ ì ‘ê·¼ ê°€ëŠ¥
POST /**               â†’ USER ë˜ëŠ” MANAGER ì—­í• ë§Œ ì ‘ê·¼ ê°€ëŠ¥
PATCH /posts/views/**  â†’ ëˆ„êµ¬ë‚˜ ì ‘ê·¼ ê°€ëŠ¥
PATCH /**              â†’ ëª¨ë‘ í—ˆìš© (ì£¼ì˜ í•„ìš”)
DELETE /**             â†’ USER ë˜ëŠ” MANAGERë§Œ ê°€ëŠ¥
```

* `oauth2Login()`
  â†’ ì†Œì…œ ë¡œê·¸ì¸ ê¸°ëŠ¥ ì„¤ì •

  * ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì‹¤í–‰í•  í•¸ë“¤ëŸ¬
  * ì‹¤íŒ¨ ì‹œ ì‹¤í–‰í•  í•¸ë“¤ëŸ¬
  * ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ ì„œë¹„ìŠ¤ ë“±ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### ğŸ§· í•„í„° ë“±ë¡ (`addFilterBefore`)

Spring Securityì˜ ê¸°ë³¸ í•„í„° ì•ì— ì»¤ìŠ¤í…€ í•„í„°ë“¤ì„ ë“±ë¡í•©ë‹ˆë‹¤. ì‹¤í–‰ ìˆœì„œê°€ ì¤‘ìš”í•©ë‹ˆë‹¤.

```java
http.addFilterBefore(new FilterExceptionHandler(), UsernamePasswordAuthenticationFilter.class);
http.addFilterBefore(singleVisitInterceptor, UsernamePasswordAuthenticationFilter.class);
http.addFilterBefore(authenticationFilter, UsernamePasswordAuthenticationFilter.class);
```

* `FilterExceptionHandler`: í•„í„° ë‹¨ê³„ì—ì„œ ë°œìƒí•œ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
* `singleVisitInterceptor`: ë°©ë¬¸ì ìˆ˜ ì²´í¬ ë˜ëŠ” ì¤‘ë³µ ë°©ë¬¸ ë°©ì§€ ë“±ì˜ ì—­í• ë¡œ ì¶”ì •ë©ë‹ˆë‹¤.
* `authenticationFilter`: JWT í† í°ì„ ê²€ì‚¬í•˜ì—¬ ì¸ì¦ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

---

### ğŸ’¡ ì£¼ì…ë˜ëŠ” ì£¼ìš” ì˜ì¡´ì„±ë“¤

* `JwtAuthenticationFilter`: JWT í† í°ì„ ê²€ì¦í•˜ê³  ì¸ì¦ ì²˜ë¦¬
* `CustomOAuth2UserService`: ì†Œì…œ ë¡œê·¸ì¸ ì‹œ ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜´
* `OAuth2AuthenticationSuccessHandler`: ì†Œì…œ ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì‹¤í–‰ë˜ëŠ” ë¡œì§ ì²˜ë¦¬
* `CustomAuthenticationFailureHandler`: ì†Œì…œ ë¡œê·¸ì¸ ì‹¤íŒ¨ ì‹œ ì²˜ë¦¬
* `SingleVisitInterceptor`: íŠ¹ì • ìš”ì²­ì˜ ë°©ë¬¸ ì œì–´ ë¡œì§ ë‹´ë‹¹

---

### âœ¨ ì •ë¦¬

`SecurityConfig`ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤:

* JWT ê¸°ë°˜ ë¡œê·¸ì¸ ì²˜ë¦¬
* ì†Œì…œ ë¡œê·¸ì¸(OAuth2) ì—°ë™
* URL ê²½ë¡œë³„ë¡œ ì ‘ê·¼ ê¶Œí•œ ì„¸ë°€í•˜ê²Œ ì œì–´
* ë³´ì•ˆ í•„í„°ë¥¼ ì¶”ê°€í•˜ì—¬ ì¸ì¦, ì˜ˆì™¸ ì²˜ë¦¬ ë“± ë‹¤ì–‘í•œ ë³´ì•ˆ ë¡œì§ ì ìš©

ì´ëŸ¬í•œ ì„¤ì •ì„ í†µí•´ REST API í™˜ê²½ì—ì„œ ë³´ë‹¤ ì•ˆì „í•˜ê³  íš¨ìœ¨ì ì¸ ì¸ì¦/ì¸ê°€ ì²˜ë¦¬ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

'''
